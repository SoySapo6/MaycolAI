import { WAMessageStubType } from '@whiskeysockets/baileys'
import fetch from 'node-fetch'

export async function before(m, { conn, participants, groupMetadata }) {
  if (!m.messageStubType || !m.isGroup) return true

  let who = m.messageStubParameters[0]
  let taguser = `@${who.split('@')[0]}`
  let chat = global.db.data.chats[m.chat]
  let defaultImage = 'https://files.catbox.moe/dgvj76.jpg';

  if (chat.welcome) {
    let img;
    try {
      let pp = await conn.profilePictureUrl(who, 'image');
      img = await (await fetch(pp)).buffer();
    } catch {
      img = await (await fetch(defaultImage)).buffer();
    }

  const welcomeMessage = global.db.data.chats[m.chat]?.welcomeMessage || 'Bienvenido/a :';

    if (m.messageStubType === WAMessageStubType.GROUP_PARTICIPANT_ADD) {
    let bienvenida = `ìÜ©¬∞¬ªÔΩ°Àö ‚àæÔΩ•‚ÅôÔΩ• ·É¶ ‚ûµ ‚Åò ‚ûµ ·É¶ ÔΩ•‚ÅôÔΩ•‚àæ Àö ÔΩ°¬´¬∞ìÜ™\n‚ùç‚åá‚îÄ‚û≠ *W·¥á ü·¥Ñ·¥è·¥ç·¥á ·¥õ·¥è G Ä·¥è·¥ú·¥ò ::*\n‡πë Àö Õô€™€™Ã•@${m.messageStubParameters[0].split`@`[0]} üëãüèªÍí±\n\n‚îå *\`…¢ Ä·¥è·¥ú·¥ò::\`*\n  ‚òï ·©ô·©û‚úë ${groupMetadata.subject}\n‚îî‚î¨ *…¥·¥á·¥° ·¥ç·¥á·¥ç ô·¥á Ä*\n    Ô∏±¬∑Àöü§ç Disfruta del grupo we.\n    ‚îî‚ïæ◊Ö‚ï¥◊ÇÍ®™‚ïå‚ïº·™∂‚ïæ·™∂ „Ä´€™‚îÑ◊Ö·çù÷ü‚ÉØ‚ïå‚ïº·™∂÷ò‚ïæ·™∂‚ïå◊ÖÍ®™‚ï∂€™‚ïº‚îò\n\n> ¬© ·¥ò·¥è·¥°·¥á Ä·¥á·¥Ö  ô è ·¥ç·¥è·¥è…¥ “ì·¥è Ä·¥Ñ·¥á ·¥õ·¥á·¥Ä·¥ç`
      await conn.sendMessage(m.chat, { image: img, caption: bienvenida, mentions: [who] }, { quoted: fkontak })
    } else if (m.messageStubType === WAMessageStubType.GROUP_PARTICIPANT_REMOVE || m.messageStubType === WAMessageStubType.GROUP_PARTICIPANT_LEAVE) {

const despMessage = global.db.data.chats[m.chat]?.despMessage || 'Se Fueüòπ';

     let bye = `ìÜ©¬∞¬ªÔΩ°Àö ‚àæÔΩ•‚ÅôÔΩ• ·É¶ ‚ûµ ‚Åò ‚ûµ ·É¶ ÔΩ•‚ÅôÔΩ•‚àæ Àö ÔΩ°¬´¬∞ìÜ™\n‚ùç‚åá‚îÄ‚û≠ *S·¥á·¥á  è·¥è·¥ú L·¥Ä·¥õ·¥á Ä ::*\n‡πë Àö Õô€™€™Ã•@${m.messageStubParameters[0].split`@`[0]} üñïüèªÍí±\n\n‚îå *\`Raro..\`*\n‚îî‚î¨ *·¥áx ·¥ç·¥á·¥ç ô·¥á Ä*\n    Ô∏±¬∑ÀöSe nos fue :c\n    ‚îî‚ïæ◊Ö‚ï¥◊ÇÍ®™‚ïå‚ïº·™∂‚ïæ·™∂ „Ä´€™‚îÑ◊Ö·çù÷ü‚ÉØ‚ïå‚ïº·™∂÷ò‚ïæ·™∂‚ïå◊ÖÍ®™‚ï∂€™‚ïº‚îò\n\n> ¬© ·¥ò·¥è·¥°·¥á Ä·¥á·¥Ö  ô è ·¥ç·¥è·¥è…¥ “ì·¥è Ä·¥Ñ·¥á ·¥õ·¥á·¥Ä·¥ç`
      await conn.sendMessage(m.chat, { image: img, caption: bye, mentions: [who] }, { quoted: fkontak })
    }
  }

  return true
}